name: Auto WIP Label

on:
  pull_request:
    branches: [main]

  # 수동 테스트용
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR 번호'
        required: true
        type: number

jobs:
  add-wip-label:
    if: github.event.action == 'opened' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write

    steps:
      - name: Add WIP label
        run: |
          PR_NUMBER="${{ github.event.pull_request.number || github.event.inputs.pr_number }}"
          echo "PR #${PR_NUMBER}에 wip 라벨을 추가합니다."
          gh pr edit ${PR_NUMBER} --add-label "wip"
          echo "✅ wip 라벨 추가 완료"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}

      - name: Post comment
        run: |
          PR_NUMBER="${{ github.event.pull_request.number || github.event.inputs.pr_number }}"
          gh pr comment ${PR_NUMBER} --body "## 📋 WIP 라벨이 추가되었습니다

**AI 코드 검사 프로세스:**
1. 개발 완료 후 **wip 라벨을 제거**하세요
2. AI 검사가 자동으로 실행됩니다
3. 머지하려면 **${{ vars.AI_REVIEW_REQUIRED_COUNT || 3 }}개**의 AI 검사 통과가 필요합니다
4. 수동으로 추가 검사: Actions 탭에서 **AI Code Review** 워크플로우 실행

> 💡 wip 라벨이 붙어있으면 push해도 AI 검사가 실행되지 않아 비용이 절감됩니다.
"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
